CREATE TABLE OFFENDER_PROGRAM_PROFILES
(
  OFF_PRGREF_ID                   NUMBER(10)                          NOT NULL,
  OFFENDER_BOOK_ID                NUMBER(10)                          NOT NULL,
  PROGRAM_ID                      NUMBER(10)                          NOT NULL,
  OFFENDER_START_DATE             DATE,
  OFFENDER_PROGRAM_STATUS         VARCHAR2(12)   DEFAULT 'PLAN'       NOT NULL,
  CRS_ACTY_ID                     NUMBER(10),
  REFERRAL_PRIORITY               VARCHAR2(12),
  REFERRAL_DATE                   DATE,
  REFERRAL_COMMENT_TEXT           VARCHAR2(1000),
  OFFENDER_END_REASON             VARCHAR2(12),
  AGREED_TRAVEL_FARE              NUMBER(11,2),
  AGREED_TRAVEL_HOUR              NUMBER(6,2),
  OFFENDER_END_COMMENT_TEXT       VARCHAR2(240),
  REJECT_DATE                     DATE,
  WAITLIST_DECISION_CODE          VARCHAR2(12),
  REFERRAL_STAFF_ID               NUMBER(10),
  OFFENDER_END_DATE               DATE,
  CREDIT_WORK_HOURS               NUMBER(8,2),
  CREDIT_OTHER_HOURS              NUMBER(8,2),
  SUSPENDED_FLAG                  VARCHAR2(1)    DEFAULT 'N',
  REJECT_REASON_CODE              VARCHAR2(12),
  AGY_LOC_ID                      VARCHAR2(6),
  CREATE_DATETIME                 TIMESTAMP(9)   DEFAULT SYSTIMESTAMP NOT NULL,
  CREATE_USER_ID                  VARCHAR2(32)   DEFAULT USER         NOT NULL,
  MODIFY_DATETIME                 TIMESTAMP(9)   DEFAULT SYSTIMESTAMP,
  MODIFY_USER_ID                  VARCHAR2(32),
  REVIEWED_BY                     VARCHAR2(32),
  OFFENDER_SENT_CONDITION_ID      NUMBER(10),
  SENTENCE_SEQ                    NUMBER(6),
  HOLIDAY_FLAG                    VARCHAR2(1)    DEFAULT 'N',
  START_SESSION_NO                NUMBER(6),
  PARENT_OFF_PRGREF_ID            NUMBER(10),
  OFFENDER_PRG_OBLIGATION_ID      NUMBER(10),
  PROGRAM_OFF_PRGREF_ID           NUMBER(10),
  PROFILE_CLASS                   VARCHAR2(12)   DEFAULT 'PRG',
  COMPLETION_DATE                 DATE,
  NEEDED_FLAG                     VARCHAR2(1)    DEFAULT 'Y',
  COMMENT_TEXT                    VARCHAR2(240),
  EARLY_END_REASON                VARCHAR2(12),
  OFFENDER_ID                     NUMBER(10),
  MEDICAL_RECORD_SEQ              NUMBER(6),
  PARAMETER_1                     VARCHAR2(12),
  SEAL_FLAG                       VARCHAR2(1),
  
  CONSTRAINT OFFENDER_PROGRAM_PROFILES_PK PRIMARY KEY (OFF_PRGREF_ID),
  
  CONSTRAINT OFF_PRGREF_OB_FK              FOREIGN KEY (OFFENDER_BOOK_ID)                REFERENCES OFFENDER_BOOKINGS (OFFENDER_BOOK_ID),
  CONSTRAINT OFF_PRG_PROF_PRG_SERV_FK      FOREIGN KEY (PROGRAM_ID)                      REFERENCES PROGRAM_SERVICES (PROGRAM_ID),
  CONSTRAINT OFF_PRG_PROF_CRS_ACTY_FK      FOREIGN KEY (CRS_ACTY_ID)                     REFERENCES COURSE_ACTIVITIES (CRS_ACTY_ID),
  CONSTRAINT OFF_PRG_PRFL_STF_FK           FOREIGN KEY (REFERRAL_STAFF_ID)               REFERENCES STAFF_MEMBERS (STAFF_ID),
--   CONSTRAINT OFF_PRG_PRFL_OFF_COND_FK      FOREIGN KEY (OFFENDER_SENT_CONDITION_ID)      REFERENCES OFFENDER_SENT_CONDITIONS(OFFENDER_SENT_CONDITION_ID),
--   CONSTRAINT OFF_PRG_PRFL_OFF_PRG_OBG_FK   FOREIGN KEY (OFFENDER_PRG_OBLIGATION_ID)      REFERENCES OFFENDER_PRG_OBLIGATIONS(OFFENDER_PRG_OBLIGATION_ID),
  CONSTRAINT OFF_PRG_PRFL_OFF_PRG_PRFL_FK2 FOREIGN KEY (PROGRAM_OFF_PRGREF_ID)           REFERENCES OFFENDER_PROGRAM_PROFILES(OFF_PRGREF_ID),
--   CONSTRAINT OFF_PROG_P_OFF_MED_R_FK1      FOREIGN KEY (OFFENDER_ID, MEDICAL_RECORD_SEQ) REFERENCES OFFENDER_MEDICAL_RECORDS(OFFENDER_ID, MEDICAL_RECORD_SEQ)
);

-- Inclusion of DECODE function within UNIQUE index declaration not supported in HSQLDB.
-- ALTER TABLE OFFENDER_PROGRAM_PROFILES ADD UNIQUE (OFFENDER_BOOK_ID, CRS_ACTY_ID, DECODE(OFFENDER_PROGRAM_STATUS,'ALLOC','ALLOC',TO_CHAR(OFF_PRGREF_ID)));
